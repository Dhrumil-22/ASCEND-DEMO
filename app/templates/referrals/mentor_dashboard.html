{% extends "base.html" %}

{% block title %}Referral Requests - ASCEND{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">Referral Requests</h1>
            <a href="{{ url_for('main.mentor_dashboard') }}" class="btn btn-sm btn-outline">â† Back to Dashboard</a>
        </div>
    </div>

    {% if referrals %}
    <div class="question-list">
        {% for referral in referrals %}
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-between align-center">
                    <div>
                        <h3 class="card-title">{{ referral.student.user.name }}</h3>
                        <div class="question-meta">
                            <span>ğŸ¢ {{ referral.company.name }}</span>
                            <span>ğŸ“… {{ referral.requested_at.strftime('%b %d, %Y') }}</span>
                            <span>ğŸ“ {{ referral.student.branch }} - {{ referral.student.batch_year }}</span>
                        </div>
                    </div>
                    <span class="badge badge-{{ 
                            'success' if referral.status == 'approved' else 
                            ('danger' if referral.status == 'rejected' else 'warning') 
                        }}">
                        {{ referral.status|title }}
                    </span>
                </div>
            </div>
            <div class="card-body">
                <h4 class="mb-2">Student's Message:</h4>
                <p style="white-space: pre-wrap; line-height: 1.8;">{{ referral.message }}</p>

                {% if referral.student.skills %}
                <div class="mt-2">
                    <strong>Skills:</strong> {{ referral.student.skills }}
                </div>
                {% endif %}

                {% if referral.mentor_response %}
                <div class="mt-3 p-3 rounded" style="background-color: var(--bg-secondary);">
                    <h5 class="mb-2">Your Response:</h5>
                    <p class="mb-0" style="white-space: pre-wrap;">{{ referral.mentor_response }}</p>
                </div>
                {% endif %}
            </div>

            {% if referral.status == 'requested' %}
            <div class="card-footer">
                <form method="POST" action="{{ url_for('main.respond_referral', id=referral.id) }}">
                    <div class="form-group">
                        <label class="form-label" for="response-{{ referral.id }}">Your Response</label>
                        <textarea class="form-control" id="response-{{ referral.id }}" name="response" rows="3"
                            placeholder="Provide your response to the student..." required></textarea>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" name="action" value="approve" class="btn btn-success">
                            âœ… Approve Referral
                        </button>
                        <button type="submit" name="action" value="reject" class="btn btn-danger">
                            âŒ Decline Request
                        </button>
                    </div>
                </form>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center p-4">
            <h3 class="text-secondary">No referral requests</h3>
            <p class="text-secondary">You'll see referral requests from students here.</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}